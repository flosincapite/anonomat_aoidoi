{% extends "base.html" %}

{% block additional_styles %}
  <style>

  .activearrow {
    font-size: 30px;
    cursor: pointer;
  }

  .activearrow:hover {
    font-color: #ff1111;
  }

  .page {
    margin: auto;
    border: 2px solid black;
  }

  .centered {
    margin: auto;
    width: 20%;
    position: relative;
  }

  .image_left {
    float: left;
    width: 49%;
  }

  .image_right {
    float: left;
    width: 50%;
    border-left: 1px solid black;
  }

  .row::after {
    content: "";
    clear: both;
    display: table;
  }
{% endblock %}

{% block content %}
    <div class="page">
      <div class="row">
        <div class="image_left">
          <img
            id="left_page" src="{{ left_page }}" type="application/png"
            style="width:100%" />
        </div>
        <div class="image_right">
          <img
            id="right_page" src="{{ right_page }}" type="application/png"
            style="width:100%" />
        </div>
      </div>
    </div>

    <div class="centered">
      <span class="activearrow" id="leftarrow">&#8701;</span> |
      <span class="activearrow" id="rightarrow">&#8702;</span>
    </div>

<script>

var _currentPage = "{{ page_number }}";
var _issue = "{{ issue_number }}";

function handleClick(_direction) {
  var xhr = new XMLHttpRequest();
  xhr.open('POST', '/nextpage');
  xhr.setRequestHeader('Content-Type', 'application/json');

  xhr.onload = function() {
    console.log(xhr);
    response = JSON.parse(xhr.responseText);
    if (response.hasLeft) {
      // TODO: make left arrow clickable.
    } else {
      // TODO: Unclickable.
    }
    document.getElementById("left_page").setAttribute("src", response.leftPng);
    document.getElementById("right_page").setAttribute("src", response.rightPng);
    _currentPage = response.nextPage;
    if (response.hasRight) {
      // TODO: make right arrow clickable.
    } else {
      // TODO: Unclickable.
    }
  };

  const request = JSON.stringify({
    direction: _direction, currentPage: _currentPage, issue: _issue,
  });
  xhr.send(request);
}

function leftArrow() {
  handleClick("-2");
}

var leftarrow = document.getElementById("leftarrow");
leftarrow.addEventListener("click", leftArrow, true);

function rightArrow() {
  handleClick("2");
}

var rightarrow = document.getElementById("rightarrow");
rightarrow.addEventListener("click", rightArrow, true);

</script>

{% endblock %}
